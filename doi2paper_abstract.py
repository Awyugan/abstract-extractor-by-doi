import requestsfrom requests.adapters import HTTPAdapterfrom urllib3.util.retry import Retryimport csvimport timeimport logging# Setup logginglogging.basicConfig(filename='doi2paper_abstract.log', level=logging.INFO, format='%(asctime)s - %(levelname)s - %(message)s')# Setup retry strategy with 'allowed_methods'retry_strategy = Retry(    total=3,    status_forcelist=[429, 500, 502, 503, 504],    allowed_methods=["HEAD", "GET", "OPTIONS"],    backoff_factor=1)adapter = HTTPAdapter(max_retries=retry_strategy)http = requests.Session()http.mount("https://", adapter)http.mount("http://", adapter)# File operations with context managers for automatic closingwith open('doi_abstract.csv', 'a', newline='') as csv_file, open('abstract_exception.txt', 'w') as exception_txt, open('abstract_not_200.txt', 'w') as error_txt:    csv_writer = csv.DictWriter(csv_file, fieldnames=['DOI', 'ABSTRACT'])    if csv_file.tell() == 0:  # Write header only if file is empty        csv_writer.writeheader()    error_txt.write('Below DOI should be moved to doi_list.txt and get the result again:\n')    doi_dict = {}    time_start = time.time()    with open('doi_list.txt', 'r') as f:        for line in f:            doi = line.strip()            if not doi:                continue            try:                response = http.get(f'https://api.semanticscholar.org/graph/v1/paper/{doi}?fields=abstract')                if response.status_code != 200:                    logging.warning(f'{doi} response status: {response.status_code}')                    error_txt.write(doi + '\n')                else:                    abstract = response.json().get('abstract', 'NULL')                    csv_writer.writerow({'DOI': doi, 'ABSTRACT': abstract})                    logging.info(f'{doi} success')            except Exception as e:                logging.error(f'Exception for {doi}: {e}')                exception_txt.write(doi + '\n')    time_end = time.time()    logging.info(f'Time cost {time_end-time_start:.2f}s')